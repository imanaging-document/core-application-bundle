{% set modulesLvl2 = getModulesLevel2ByRoute(app.user, app.request.get('_route')) %}

{% if modulesLvl2|length > 0 %}
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;600;800&display=swap">

  <style>
      .app-container{
          min-height: calc(100vh - 60px);
          flex-grow: 1;
      }

      .left-menu{
          width: 17%
      }

      .cn-vertical-menu{
          border-right: 1px solid black;
          min-height: 100%;
      }

      .cn-vertical-menu ul{
          list-style-type: none;
          margin: 0;
          padding: 0;
      }

      .cn-vertical-menu ul li span{
          position: relative;
          display: block;
          padding: 24px 36px;
          font-size: 17px;
          font-family: Montserrat, sans-serif;;
          color: #202121;
          cursor: pointer;
          background: #f4f7f6;
          border-bottom: 1px solid #E6EAEA;
          transition: background 0.3s ease-in-out, border 0.3s ease-in-out, color 0.3s ease-in-out;
      }

      .cn-vertical-menu ul li span a{
          color: #202121;
      }

      .cn-vertical-menu ul li span:hover{
          background: white;
      }

      .cn-vertical-menu ul li.current-item span{
          background-color: #A1D5CF;
          font-weight: 600;
      }

      .cn-vertical-menu ul li span.title{
          cursor: auto;
          font-size: 24px;
          text-align: center;
          border-bottom: 0;
      }
  </style>

  <div class="left-menu">
    <div class="cn-vertical-menu">
      <ul>
        <li>
          <span class="title">{{ getModuleNameByRoute(app.user, app.request.get('_route')) }}</span>
        </li>
      </ul>
      <ul>
        {% for module in modulesLvl2 %}
          <li class="{% if module.route == app.request.get('_route') %}current-item{% endif %}">
            {% if module.children|length > 0 %}
              <span class="{% if module.route == app.request.get('_route') %}current-item{% endif %}">
                {{ module.libelle }}
              </span>
            {% else %}
              <span>
                <a href="{% if module.route != "" %}{{ path(module.route) }}{% else %}#{% endif %}"
                   class="link-with-loader {% if module.route == app.request.get('_route') %}current-item{% endif %}">
                  {{ module.libelle }}
                </a>
              </span>
            {% endif %}

            {% if module.children|length > 0 %}
              <ul>
                {% for sousModule in module.children %}
                  {% if sousModule.route == '' or isRouteExiste(sousModule.route) %}
                    <li>
                      <span>
                        <a {% if sousModule.children|length > 0 %}href="#" class="dropdown-item dropdown-toggle link-with-loader"{% else %}
                          href="{% if sousModule.route != "" %}{{ path(sousModule.route) }}{% else %}#{% endif %}" class="dropdown-item link-with-loader"{% endif %}>
                          {{ sousModule.libelle }}
                        </a>
                      </span>
                    </li>
                    {% include '@ImanagingCoreApplication/Menu/vertical_menu_recursive.twig' %}
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <script>
    $("a.link-with-loader").click(function(){
      $('<div class="global-loader"><h4><i class="fa fa-spin fa-spinner fa-fw"></i>Chargement en cours ...</h4></div>').prependTo(document.body);
    })

    $("div.link-with-loader").click(function(){
      $('<div class="global-loader"><h4><i class="fa fa-spin fa-spinner fa-fw"></i>Redirection en cours ...</h4></div>').prependTo(document.body);
    })
  </script>
{% endif %}